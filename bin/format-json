#!/usr/bin/env ruby

require 'optparse'
require 'json_better_formatter'
require 'json_better_formatter/version'

opts = OptionParser.new do |opts|
  opts.banner = "Usage: format-json [options]Â FILE"

  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit
  end

  opts.on_tail("-v", "--version", "Print the version number of format-json") do
    puts "format-json #{JsonBetterFormatter::VERSION}"
    exit
  end
end

opts.parse!

file = ARGV.first

if file.nil? || !File.exists?(file)
  puts opts
  exit! 1
else
  begin
    JsonBetterFormatter.new(in: file).format
  rescue JsonBetterFormatter::UnparseableError => e
    $stderr.puts e
    exit! 1
  rescue Errno::EPIPE
    # Do nothing
  end
end
